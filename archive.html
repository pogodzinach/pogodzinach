<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PO GODZINACH ZIN - Archive</title>
    <link href="https://fonts.googleapis.com/css2?family=Vollkorn:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.min.js"></script>
    <style>
        /* ... (previous styles remain the same) ... */

        #book-container {
            width: 800px;
            height: 600px;
            margin: 20px auto;
            display: none;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .page-wrapper {
            background-color: #f0f0f0;
        }

        /* ... (rest of the styles remain the same) ... */
    </style>
</head>
<body>
    <!-- ... (previous HTML content remains the same) ... -->

    <script src="turn.js"></script>
    <script>
        // ... (previous JavaScript code remains the same) ...

        async function loadDesktopBook() {
            const pages = [];
            let maxWidth = 0;
            let maxHeight = 0;

            // Pre-render all pages
            for (let i = 1; i <= pageCount; i++) {
                const pdfPage = await pdfDoc.getPage(i);
                const scale = 1.5;
                const viewport = pdfPage.getViewport({ scale });
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                await pdfPage.render(renderContext);

                maxWidth = Math.max(maxWidth, canvas.width);
                maxHeight = Math.max(maxHeight, canvas.height);

                pages.push(canvas);
            }

            // Clear the book container
            bookContainer.innerHTML = '';

            // Create page elements with consistent dimensions
            for (let i = 0; i < pages.length; i++) {
                const page = document.createElement('div');
                page.className = 'page';
                page.style.width = `${maxWidth}px`;
                page.style.height = `${maxHeight}px`;

                const wrapper = document.createElement('div');
                wrapper.style.width = '100%';
                wrapper.style.height = '100%';
                wrapper.style.display = 'flex';
                wrapper.style.justifyContent = 'center';
                wrapper.style.alignItems = 'center';

                wrapper.appendChild(pages[i]);
                page.appendChild(wrapper);
                bookContainer.appendChild(page);
            }

            // Add an empty page if the total is odd
            if (pages.length % 2 !== 0) {
                const emptyPage = document.createElement('div');
                emptyPage.className = 'page';
                emptyPage.style.width = `${maxWidth}px`;
                emptyPage.style.height = `${maxHeight}px`;
                bookContainer.appendChild(emptyPage);
            }

            // Set the book container dimensions
            bookContainer.style.width = `${maxWidth * 2}px`;
            bookContainer.style.height = `${maxHeight}px`;

            // Initialize Turn.js
            $(bookContainer).turn({
                width: maxWidth * 2,
                height: maxHeight,
                autoCenter: true,
                duration: 1000,
                acceleration: true,
                gradients: true,
                elevation: 50,
                pages: bookContainer.children.length,
                when: {
                    turning: function(event, page, view) {
                        if (page === 1) {
                            event.preventDefault();
                        }
                    }
                }
            });

            // Fade in the book container
            bookContainer.style.display = 'block';
            setTimeout(() => {
                bookContainer.style.opacity = '1';
            }, 50);
        }

        async function loadBook(pdfName) {
            if (currentPDF === pdfName) return;
            currentPDF = pdfName;
            
            loadingScreen.style.display = 'flex';
            bookContainer.style.display = 'none';
            bookContainer.style.opacity = '0';
            mobileBookContainer.style.display = 'none';
            bookContainer.innerHTML = '';
            mobileBookContainer.innerHTML = '';

            const loadingTask = pdfjsLib.getDocument(pdfName);
            pdfDoc = await loadingTask.promise;
            pageCount = pdfDoc.numPages;

            if (isMobile) {
                await loadMobileBook();
            } else {
                await loadDesktopBook();
            }

            loadingScreen.style.display = 'none';
        }

        // ... (rest of the JavaScript code remains the same) ...
    </script>
</body>
</html>
